---
const { variant = "desktop" } = Astro.props;
const baseClasses = "flex flex-col";
const isMobile = variant === "mobile";
const containerClass = isMobile
  ? `${baseClasses} px-4 py-2 gap-4`
  : `${baseClasses} h-full px-6`;
const listClass = isMobile ? "list-none pl-0 space-y-2 text-base" : "list-none pl-0 space-y-2 text-sm";
/**
 * A TocNav automatikusan kiemeli az éppen látható szakaszt
 * (pl. <section id="intro"> vagy <h2 id="section1"> alapján).
 * 
 * Nem kell YAML-ból beolvasni, mert dinamikusan végigmegy a DOM elemein.
 */
---

<div
  x-data="{ 
    activeId: '',
    headings: [],
    init() {
      this.headings = Array.from(document.querySelectorAll('main h1[id], main h2[id], main h3[id], main h4[id], main h5[id], main h6[id]')).map(h => ({ 
        id: h.id, 
        label: h.textContent.trim() 
      }));
      
      const onScroll = () => {
        let current = '';
        let minDistance = Infinity;
        
        this.headings.forEach((item) => {
          const element = document.getElementById(item.id);
          if (element) {
            const rect = element.getBoundingClientRect();
            const distance = Math.abs(rect.top - 150);
            
            // Ha a cím látható a képernyőn (a teteje 150px alatt van)
            if (rect.top <= 200 && rect.bottom >= 50) {
              if (distance < minDistance) {
                minDistance = distance;
                current = item.id;
              }
            }
          }
        });
        
        this.activeId = current;
      };
      
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    }
  }"
  class={containerClass}
>
  <h2 class={`text-lg font-semibold mb-4 ${isMobile ? "px-1" : ""}`}>Tartalomjegyzék</h2>
  <nav>
    <ul class={listClass}>
      <template x-for="link in headings" :key="link.id">
        <li>
          <a
            :href="'#' + link.id"
            :class="activeId === link.id ? 'block pl-3 border-l-4 border-blue-600 text-blue-700 font-semibold transition' : 'block pl-3 border-l-4 border-transparent text-gray-700 hover:text-blue-600 hover:border-blue-200 transition'"
            x-text="link.label"
          ></a>
        </li>
      </template>
    </ul>
  </nav>
</div>
