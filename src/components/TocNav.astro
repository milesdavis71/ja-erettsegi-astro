---
/**
 * A TocNav automatikusan kiemeli az éppen látható szakaszt
 * (pl. <section id="intro"> vagy <h2 id="section1"> alapján).
 * 
 * Nem kell YAML-ból beolvasni, mert dinamikusan végigmegy a DOM elemein.
 */
---

<div
  x-data="{ activeId: '' }"
  x-init="
    const headings = document.querySelectorAll('main section[id], main h2[id]');
    const onScroll = () => {
      let current = '';
      headings.forEach((h) => {
        const rect = h.getBoundingClientRect();
        if (rect.top <= 150 && rect.bottom >= 150) current = h.id;
      });
      activeId = current;
    };
    window.addEventListener('scroll', onScroll);
    onScroll();
  "
  class="h-full flex flex-col px-6"
>
  <h2 class="text-lg font-semibold mb-4">Tartalomjegyzék</h2>
  <nav>
    <ul class="space-y-2 text-sm">
      <template x-for="link in Array.from(document.querySelectorAll('main section[id], main h2[id]')).map(h => ({ id: h.id, label: h.textContent }))">
        <li>
          <a
            :href="'#' + link.id"
            :class="activeId === link.id
              ? 'block pl-3 border-l-4 border-blue-600 text-blue-700 font-semibold transition'
              : 'block pl-3 border-l-4 border-transparent text-gray-700 hover:text-blue-600 hover:border-blue-200 transition'"
            x-text="link.label"
          ></a>
        </li>
      </template>
    </ul>
  </nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
