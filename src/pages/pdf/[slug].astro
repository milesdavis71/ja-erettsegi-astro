---
import DefaultLayout from '../../layouts/DefaultLayout.astro'
import PdfViewer from '../../components/PdfViewer.astro'
import teachers from '../../data/teachers.yml'

interface Teacher {
  slug: string
  name: string
  subject: string
  lessonTypes: string
  image: string
  thumbnail: string
  pdf: string
  bio: string
}

function isValidPdfPath(pdfPath: string) {
  // alap validáció: legyen abszolút útvonal és .pdf-re végződjön
  return (
    typeof pdfPath === 'string' && pdfPath.startsWith('/') && pdfPath.toLowerCase().endsWith('.pdf')
  )
}

export async function getStaticPaths() {
  return (teachers as Teacher[])
    .filter((teacher) => teacher.pdf) // csak azok, akiknek van PDF-je
    .map((teacher) => ({
      params: { slug: teacher.slug },
      props: { teacher },
    }))
}

const { teacher } = Astro.props as { teacher: Teacher }

const teacherPdf = teacher?.pdf
const hasValidPdf = !!teacherPdf && isValidPdfPath(teacherPdf)
---

<DefaultLayout title={`${teacher.name} - CV`}>
  <div class="container mx-auto px-4 py-8">
    <!-- Fejléc -->
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800">{teacher.name} - Önéletrajz</h1>
      <div class="mt-2 h-1 w-24 bg-pink-400"></div>
      <p class="mt-4 text-gray-600">
        Tantárgy: <span class="font-medium">{teacher.subject}</span> | Óratípus: <span
          class="font-medium">{teacher.lessonTypes}</span
        >
      </p>
    </header>

    <!-- PDF Viewer -->
    <div class="mb-8">
      {
        hasValidPdf ? (
          <PdfViewer pdfUrl={teacherPdf} />
        ) : (
          <div class="rounded-lg border border-yellow-300 bg-yellow-50 p-4 text-yellow-900">
            A PDF jelenleg nem elérhető ehhez a tanárhoz.
          </div>
        )
      }
    </div>

    <!-- További információk -->
    <div class="rounded-lg bg-gray-50 p-6">
      <h2 class="mb-4 text-xl font-bold text-gray-800">További információk</h2>
      <div class="prose max-w-none">
        <p class="text-gray-700">{teacher.bio}</p>
      </div>
      <div class="mt-6">
        <a
          href={hasValidPdf ? teacherPdf : '#'}
          download
          aria-disabled={!hasValidPdf}
          class:list={[
            'inline-flex items-center rounded px-4 py-2 text-white',
            hasValidPdf ? 'bg-blue-600 hover:bg-blue-700' : 'cursor-not-allowed bg-gray-400',
          ]}
        >
          <svg
            class="mr-2 h-5 w-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            ></path>
          </svg>
          PDF letöltése
        </a>
        <a
          href={`/tanar/${teacher.slug}`}
          class="ml-4 inline-flex items-center rounded bg-gray-200 px-4 py-2 text-gray-800 hover:bg-gray-300"
        >
          Vissza a tanár profiljára
        </a>
      </div>
    </div>
  </div>
</DefaultLayout>
