---
import "../styles/global.css";
import global from "../data/global.yml";
import newsData from "../data/news.yml";
import MainContent from "../components/MainContent.astro";
import HeaderSection from "../components/HeaderSection.astro";
import DesktopLeftSidebar from "../components/DesktopLeftSidebar.astro";
import FooterSection from "../components/FooterSection.astro";

const { frontmatter } = Astro.props;
const { site } = global;
const { news } = newsData;
const currentPath = Astro.url.pathname;
const isIndexPage = currentPath === "/";
const showToc = isIndexPage;
const sidebarNewsCount = frontmatter?.sidebarNewsCount ?? (isIndexPage ? 0 : 3);
const sidebarNews = showToc ? [] : news.slice(0, sidebarNewsCount);
const showNewsSidebar = !showToc && sidebarNews.length > 0;
---

<html lang="hu">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{frontmatter?.title ? `${frontmatter.title} – ${site.title}` : site.title}</title>
    <meta name="description" content={frontmatter?.description || site.description} />
  </head>

  <body
    class="bg-gray-100 text-gray-800 min-h-screen"
    x-data="{ sidebarOpen: false, tocOpen: false }"
    :class="{ 'overflow-hidden': sidebarOpen || tocOpen }"
    @keydown.window.escape="sidebarOpen = false; tocOpen = false"
  >
    <HeaderSection {showToc} />

    <!-- Fő konténer - max 1440px, középre igazítva -->
    <div class="max-w-[1440px] mx-auto bg-white min-h-screen flex flex-col lg:flex-row relative">
      <DesktopLeftSidebar />

      <MainContent {frontmatter}>
        <slot />
      </MainContent>

      <FooterSection {showToc} {showNewsSidebar} {sidebarNews} />
    </div>
    
    <script>
      import '../scripts/alpine.js';
    </script>
  </body>
</html>
